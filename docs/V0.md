# Obsidian Agent - V0.0 Specification

## Phase Overview

**V0.0: Development Infrastructure & Tooling Setup**

**Goal:** Establish robust development infrastructure and tooling to enable confident, high-quality development with proper testing, tracing, and evaluation capabilities.

**Status:** üìã Planning Phase

**Prerequisites:** None (this is the foundation for all future development)

**Estimated Duration:** 1 week (5-7 days)

---

## Scope: What's In

### 1. LangSmith Observability & Debugging Setup
- Verify LangSmith tracing is working correctly
- Enhanced configuration for development workflows
- Trace analysis and debugging workflows
- Performance monitoring via traces
- Documentation for using LangSmith for debugging

### 2. ESLint Configuration Enhancement
- Comprehensive linting rules for TypeScript/LangGraph patterns
- Pre-commit hooks integration
- Auto-fix configurations
- CI/CD integration verification

---

## Detailed Requirements

### 1. LangSmith Observability & Debugging Setup

#### Objectives
- Verify LangSmith tracing integration is working correctly
- Enhance configuration for development workflows
- Enable effective debugging through trace analysis
- Document best practices for using LangSmith during development
- Set foundation for future evaluation capabilities (V1.0+)

#### Implementation Tasks

**1.1 Verify Current LangSmith Integration**

Check current state:
- Review existing LangSmith setup in plugin settings
- Test that traces are appearing in LangSmith dashboard
- Verify environment variable configuration
- Document current integration status

File: `docs/development/LANGSMITH_STATUS.md`
- Current integration status
- What works
- What needs improvement
- Known issues

**1.2 Enhanced Development Configuration**

Improve the development experience with LangSmith:

File: `src/utils/LangsmithConfig.ts` (or similar)
```typescript
export class LangsmithConfig {
  // Ensure tracing is properly configured for development
  static enableDevTracing(): void {
    if (!process.env.LANGSMITH_API_KEY) {
      console.warn('LangSmith API key not set - tracing disabled');
      return;
    }

    process.env.LANGSMITH_TRACING = 'true';
    process.env.LANGSMITH_PROJECT = process.env.LANGSMITH_PROJECT || 'obsidian-agent-dev';

    console.log(`LangSmith tracing enabled: ${process.env.LANGSMITH_PROJECT}`);
  }

  // Helper to add custom metadata to traces
  static addTraceMetadata(metadata: Record<string, any>): void {
    // Add custom metadata like version, environment, etc.
  }
}
```

**1.3 Development Workflow Scripts**

Create simple scripts to help with development:

File: `scripts/dev-with-tracing.ts`
```typescript
// Simple script to test agent with tracing enabled
import { LangsmithConfig } from '../src/utils/LangsmithConfig';

LangsmithConfig.enableDevTracing();

// Interactive REPL or simple test cases
console.log('Agent ready with LangSmith tracing enabled');
console.log('Test your agent and check traces at: https://smith.langchain.com');
```

Add npm script:
```json
{
  "scripts": {
    "dev:trace": "tsx scripts/dev-with-tracing.ts"
  }
}
```

**1.4 Trace Analysis Guide**

File: `docs/development/LANGSMITH_DEBUGGING.md`

Create comprehensive guide covering:
- How to read LangSmith traces
- Understanding the trace hierarchy (agent ‚Üí tools ‚Üí responses)
- Finding specific tool calls
- Analyzing token usage
- Identifying performance bottlenecks
- Common patterns and anti-patterns
- Screenshots and examples

**1.5 Common Debugging Scenarios**

Document solutions to common debugging needs:

1. **"Why did the agent call this tool?"**
   - How to inspect tool selection in traces
   - Understanding the agent's reasoning

2. **"Why is this slow?"**
   - Finding performance bottlenecks in traces
   - Token usage analysis
   - Tool execution timing

3. **"What went wrong?"**
   - Error analysis in traces
   - Tracing error propagation
   - Understanding failure modes

4. **"How can I reproduce this?"**
   - Using trace IDs to recreate issues
   - Extracting inputs from traces

**1.6 Optional: Simple Debugging Utilities**

Only if time permits, create lightweight helpers:

File: `src/dev/TraceHelpers.ts`
```typescript
export class TraceHelpers {
  // Simple helper to log trace URL after agent run
  static logTraceUrl(runId: string): void {
    const projectName = process.env.LANGSMITH_PROJECT || 'default';
    console.log(`View trace: https://smith.langchain.com/o/<your-org>/projects/p/${projectName}/r/${runId}`);
  }
}
```

**Deliverables:**
- [ ] LangSmith integration verified and working
- [ ] Development configuration documented
- [ ] Debugging guide created with examples
- [ ] Common scenarios documented
- [ ] Simple dev workflow scripts (optional)
- [ ] Comprehensive documentation: `docs/development/LANGSMITH_DEBUGGING.md`

**Out of Scope (Future: V1.0+):**
- Formal evaluation datasets
- Automated evaluators
- CI/CD evaluation runs
- Metrics collection pipelines
- Regression testing infrastructure

---

### 2. ESLint Configuration Enhancement

#### Objectives
- Establish comprehensive linting standards
- Enforce TypeScript and LangGraph best practices
- Automate code quality checks
- Integrate with development workflow

#### Implementation Tasks

**2.1 ESLint Configuration Analysis**

Current state assessment:
- ‚úÖ TypeScript ESLint plugin installed (`@typescript-eslint/eslint-plugin@^8.46.4`)
- ‚úÖ TypeScript parser configured (`@typescript-eslint/parser@^8.46.4`)
- ‚úÖ Lint scripts defined (`npm run lint`, `npm run lint:fix`)
- ‚úÖ CI integration in `.github/workflows/test.yml`
- ‚ö†Ô∏è No explicit ESLint config file (using defaults)
- ‚ö†Ô∏è Current warnings in codebase (promises, any types)

**2.2 Create Comprehensive ESLint Configuration**

File: `.eslintrc.json`
```json
{
  "root": true,
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2022,
    "sourceType": "module",
    "project": "./tsconfig.json"
  },
  "plugins": [
    "@typescript-eslint"
  ],
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:@typescript-eslint/recommended-requiring-type-checking"
  ],
  "rules": {
    // Async/Promise handling (address current warnings)
    "@typescript-eslint/no-floating-promises": "error",
    "@typescript-eslint/no-misused-promises": "error",
    "@typescript-eslint/await-thenable": "error",
    "@typescript-eslint/promise-function-async": "warn",

    // Type safety
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/no-unsafe-assignment": "warn",
    "@typescript-eslint/no-unsafe-member-access": "warn",
    "@typescript-eslint/no-unsafe-call": "warn",

    // LangGraph-specific patterns
    "@typescript-eslint/no-unused-vars": ["error", {
      "argsIgnorePattern": "^_",
      "varsIgnorePattern": "^_"
    }],

    // Code quality
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error",
    "no-var": "error",

    // Obsidian plugin best practices
    "no-prototype-builtins": "off" // Obsidian API uses this pattern
  },
  "ignorePatterns": [
    "node_modules/",
    "main.js",
    "*.config.mjs",
    "coverage/"
  ]
}
```

**2.3 ESLint Ignore Configuration**

File: `.eslintignore`
```
node_modules/
coverage/
dist/
main.js
*.config.mjs
esbuild.config.mjs
version-bump.mjs
```

**2.4 Pre-commit Hook Integration**

Install Husky for Git hooks:
```bash
npm install --save-dev husky lint-staged
```

File: `.husky/pre-commit`
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

File: `package.json` additions:
```json
{
  "lint-staged": {
    "*.ts": [
      "eslint --fix",
      "git add"
    ]
  }
}
```

**2.5 Address Current Linting Issues**

Current warnings to fix:
- `ChatView.ts`: 7 warnings (promises, any types)
- `AgentGraph.ts`: 5 warnings (any types)

Create ticket/task to systematically address:
1. Promise handling patterns (async/await, void handlers)
2. Type narrowing for `any` types
3. Proper error handling in event handlers

**2.6 CI/CD Enhancement**

Update `.github/workflows/test.yml`:
```yaml
- name: Lint code
  run: npm run lint

- name: Check for linting warnings
  run: npm run lint -- --max-warnings 0
```

**2.7 Documentation**

File: `docs/development/LINTING.md`
- ESLint rules explained
- How to configure editor integration
- Common patterns and fixes
- How to temporarily disable rules (when necessary)
- Pre-commit hook usage

**Deliverables:**
- [ ] `.eslintrc.json` with comprehensive rules
- [ ] `.eslintignore` configured
- [ ] Pre-commit hooks installed and working
- [ ] Current linting warnings addressed
- [ ] CI/CD enforces zero warnings
- [ ] Documentation: `docs/development/LINTING.md`

---

## Success Criteria

### LangSmith Observability & Debugging
- ‚úÖ LangSmith tracing verified working
- ‚úÖ Traces visible in LangSmith dashboard during development
- ‚úÖ Development configuration documented
- ‚úÖ Debugging guide complete with examples
- ‚úÖ Common debugging scenarios documented
- ‚úÖ Developers can effectively use traces to debug issues

### ESLint Configuration
- ‚úÖ Comprehensive linting rules in place
- ‚úÖ All current warnings addressed
- ‚úÖ Pre-commit hooks prevent new violations
- ‚úÖ CI enforces zero-warning policy
- ‚úÖ Developer documentation complete

---

## Questions & Clarifications Needed

### LangSmith Observability
**Q1:** Should LangSmith tracing be enabled by default in development?
- Enabled automatically when LANGSMITH_API_KEY is set?
- Opt-in via environment variable?
- Recommendation: Enabled when API key is present, with clear logging

**Q2:** Do you want a specific LangSmith project name for development?
- Current: Uses plugin settings (optional)
- Recommendation: `obsidian-agent-dev` as default
- Allow override via settings or env var

### ESLint Configuration
**Q3:** What's the priority for addressing current linting warnings?
- Fix all immediately before proceeding?
- Create separate task/ticket?
- Address incrementally?
- Recommendation: Address as part of V0 to establish clean baseline

**Q4:** Should we enforce `no-console` strictly or allow `console.log` in development?
- Current thinking: Allow `console.warn` and `console.error`
- Ban `console.log` in production code?
- Recommendation: Warn on console.log, allow warn/error for debugging

**Q5:** Do you want stricter rules than recommended defaults?
- Maximum function complexity?
- Maximum file length?
- Cyclomatic complexity thresholds?
- Recommendation: Start with recommended defaults, add stricter rules as needed

---

## Implementation Plan

### Week 1: LangSmith Setup

**Days 1-2: LangSmith Verification & Documentation**
- [ ] Verify LangSmith tracing is working
- [ ] Test trace visibility in dashboard
- [ ] Document current integration status
- [ ] Create enhanced dev configuration (optional)
- [ ] Create simple dev workflow scripts (optional)

**Days 3-4: Debugging Documentation**
- [ ] Write comprehensive debugging guide
- [ ] Document common debugging scenarios
- [ ] Add screenshots and examples
- [ ] Create troubleshooting section

**Day 5: ESLint Setup**
- [ ] Create `.eslintrc.json`
- [ ] Create `.eslintignore`
- [ ] Set up pre-commit hooks

### Week 2: Linting & Polish

**Days 1-2: Address Linting Issues**
- [ ] Address current warnings (12 total)
- [ ] Update CI/CD
- [ ] Write linting documentation

**Days 3-5: Final Integration & Documentation**
- [ ] End-to-end testing of all components
- [ ] Documentation review and polish
- [ ] Create developer onboarding guide
- [ ] Verify all success criteria met

---

## Documentation Deliverables

All documentation will be created in `docs/development/`:

1. **`LANGSMITH_DEBUGGING.md`**: LangSmith observability and debugging guide
   - Verifying LangSmith integration
   - Reading and analyzing traces
   - Understanding trace hierarchy
   - Common debugging scenarios
   - Performance analysis via traces
   - Troubleshooting guide
2. **`LINTING.md`**: ESLint rules and development standards
3. **`DEVELOPER_ONBOARDING.md`**: Complete setup guide for new developers

---

## Risk Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| LangSmith not working as expected | Low | Already integrated, just need to verify |
| ESLint rule conflicts | Low | Incremental rule adoption, careful testing |
| Time overrun | Low | Scope is intentionally minimal |

---

## Dependencies

**External:**
- `tsx` - TypeScript execution for scripts (optional, only if creating dev scripts)
- `langsmith` SDK - Already installed (^0.3.79)
- `husky` and `lint-staged` - For pre-commit hooks (new dependencies)

**Internal:**
- Existing LangSmith integration
- Current ESLint setup
- GitHub repository access

---

## Metrics for Success

**Quantitative:**
- LangSmith traces successfully captured and visible
- Zero ESLint warnings in codebase
- CI/CD build time < 5 minutes (with linting)

**Qualitative:**
- Developer confidence in making changes
- Easy debugging of agent issues with LangSmith traces
- Clear development workflows
- Professional code quality
- Smooth onboarding for new contributors

---

## Definition of Done

- [ ] LangSmith tracing verified and working
- [ ] LangSmith debugging guide complete with examples
- [ ] ESLint configuration comprehensive and enforced
- [ ] All current linting warnings resolved (12 warnings total)
- [ ] Pre-commit hooks prevent new violations
- [ ] CI/CD runs linting checks successfully
- [ ] Documentation complete and reviewed
- [ ] Developer onboarding guide tested
- [ ] All success criteria met

---

## Next Steps After V0.0

With development infrastructure in place, we'll be positioned to:
- Confidently develop new features (V1.0+)
- Maintain high code quality standards
- Debug issues efficiently using LangSmith traces
- Onboard contributors smoothly
- **Future (V1.0+):** Add formal evaluation framework when needed

This foundation enables rapid, high-quality iteration on the agent capabilities.

---

## Scope Clarification: What Changed

**Original Scope (Too Ambitious for V0):**
- Formal evaluation datasets
- Custom evaluators
- Automated CI/CD evaluation runs
- Metrics collection pipelines

**Refined Scope (V0 - Foundation Only):**
- Verify LangSmith tracing works
- Document how to use traces for debugging
- Set foundation for future evaluation work

**Rationale:**
At this early stage, we need observability and debugging capability, not formal evaluation infrastructure. Formal evals can be added in V1.0+ when the agent capabilities stabilize.
